# Как подключить шлюз к Алисе (пошаговое руководство)

1. Регистрируемся на https://www.wqtt.ru. На боковой панели выбираем пункт "Брокер". На экране появляется информация для подключения.
2. Включаем шлюз. Внутри загорается красный светодиод. Подключаемся телефоном или компьютером к появившейся wi-fi сети `swbd`.
3. В строку браузера вводим `http://swbd` или `192.168.4.1`.
4. В появившемся веб-интерфейсе нажимаем кнопку "edit config file", откроется окно редактирования конфигурационного файла.
5. В файле:
* в поле `ssid` вводим название вашей wi-fi сети (вместо `MY_SSID`);
* в поле `password` вводим пароль сети (вместо `MY_PASSWORD`);
* в разделе mqtt/server в поле `host` вводим `Адрес` из п.1;
* в разделе mqtt/server в поле `port` вводим `Порт` из п.1;
* в разделе mqtt/server в поле `username` вводим `Пользователь` из п.1;
* в разделе mqtt/server в поле `password` вводим `Пароль` из п.1.

    На этом конфигурация шлюза завершена.

6. Подключаем устройство качания к источнику питания. Если модель устройства качания - "Паинька" или "Тихоня", то убеждаемся, что ни один телефон не подключен к устройству.
7. Нажимаем кнопку `Save`, шлюз перезагрузится, подключится к wi-fi сети и облачному mqtt-брокеру, а затем - к устройству качания. Если всё удалось, то внутри шлюза загорится синий светодиод.
8. В строку браузера вводим `http://swbd` и убеждаемся, что в списке видимых устройств появилось устройство качания:
* `SWBDdrv_mc1` - "Паинька"
* `SWBDdrv_mc2` - "Соня"
* `SWBDdrv_mc3` - "Тихоня"
* `SWBDdrv_mc5` - "Совушка"

    Не закрываем вкладку, в дальнейшем нам понадобится MAC-адрес устройства качания.

9. В WQTT на боковой панели выбираем пункт "Настройки". Выбираем пункты "Добавить устройство"/"Мультимедиа техника". Вводим название устройства, например "Устройство качания", и название комнаты, например "Детская". Нажимаем "Сохранить и продолжить".
10. Напротив надписи "Органы управления" нажимаем "Добавить". Выбираем "Выключатель питания". В поле "Топик управления" вводим `<MAC>/swbd/enable/Set`, в поле "Топик состояния" вводим `<MAC>/swbd/enable`. Здесь `<MAC>` - это MAC-адрес устройства качания из п.8. Т.е. фактически нужно вводить в эти поля что-то типа `a4:c1:38:3d:e2:ff/swbd/enable/Set` и `a4:c1:38:3d:e2:ff/swbd/enable` соответственно.
11. Нажимаем "Сохранить" несколько раз, переходим в пункт "Dashboard". Видим панель управления с одним выключателем. Включаем выключатель - устройство качания должно начать качать кроватку.
12. Аналогичным образом  организуем другие органы управления устройством качания, руководствуемся при этом таблицей:

|Параметр|Топик управления|Топик состояния|Значения (строковый тип)|
|-|--------|---|--|
|Запущено ли качание|`<MAC>/swbd/enable`|`<MAC>/swbd/enable/Set`|`0`-не запущено, `1` - запущено|
|Мощность качания|`<MAC>/swbd/speed`|`<MAC>/swbd/speed/Set`|`1`..`6`|
|Чувствительнось датчика плача|`<MAC>/swbd/sensivity`|`<MAC>/swbd/sensivity/Set`|`0`..`5`, если `0`, то  датчик отключен|
|Включен ли датчик движения|`<MAC>/swbd/move_sens_enable`|`<MAC>/swbd/move_sens_enable/Set`|`0`- отключен, `1` - включен|
|Время качания (часы)|`<MAC>/swbd/hours`|`<MAC>/swbd/hours/Set`|`0`..`23`|
|Время качания (минуты)|`<MAC>/swbd/minutes`|`<MAC>/swbd/minutes/Set`|`0`..`59`|

    Для мощности качания можно выбрать параметр "Скорость", для датчика движения - например, "Вращение". Таймер в Алисе есть свой, поэтому внутренний можно не задействовать.

13. Устанавливаем или открываем приложение "Умный дом с Алисой", выбираем "Добавить(+)/Устройство умного дома/WQTT.RU" Далее руководствуемся подсказками на экране.
14. Переходим в WQTT, выбираем "Настройки/Обновить устройства Яндекс". Устройство качания появится в Алисе.

